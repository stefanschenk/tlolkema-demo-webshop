<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fruit Slot Machine - Fruit Shop</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body data-i18n-title="brand.titleSlot">
    <header role="banner">
      <div class="header-center">
        <a href="index.html" class="logo" data-i18n-attrs="aria-label:header.homeAria">
          <img
            src="img/fruit-shop-logo.png"
            class="logo-img"
            data-i18n-attrs="alt:header.logoAlt"
          />
          <span class="products-text" data-i18n="header.productsLink"></span>
        </a>
        <nav role="navigation" data-i18n-attrs="aria-label:common.mainNav">
          <a
            href="basket.html"
            class="basket-link"
            data-i18n-attrs="aria-label:header.basketAria"
          >
            <img
              src="img/basket-icon.png"
              class="basket-img"
              data-i18n-attrs="alt:header.basketAlt"
            />
            <span class="basket-text" data-i18n="header.basketText"></span>
          </a>
        </nav>
        <div class="lang-switcher">
          <label for="langSelect"><span data-i18n="header.chooseLanguage"></span></label>
          <select id="langSelect" onchange="setLanguage(this.value)">
            <option value="en">English</option>
            <option value="nl">Nederlands</option>
            <option value="ja">æ—¥æœ¬èªž</option>
            <option value="vi">Tiáº¿ng Viá»‡t</option>
            <option value="fy">Frysk</option>
          </select>
        </div>
      </div>
    </header>
    <main id="main-content" role="main">
      <div class="content-box">
        <div
          id="slotEmoji"
          class="emoji-display"
          role="img"
          data-i18n-attrs="aria-label:slot.displayAria"
        >ðŸŽ°</div>
        <h1 data-i18n="slot.title"></h1>
        <div class="product-desc" data-i18n="slot.desc" aria-label="Product description"></div>
        <div class="button-container">
          <button
            id="spinAndAdd"
            class="cart-action-btn"
            data-i18n-attrs="aria-label:slot.addAria"
            data-i18n="slot.addBtn"
          ></button>
        </div>
        <div id="slotStatus" class="sr-only" aria-live="polite"></div>
      </div>
    </main>
    <footer>
      <a
        href="https://www.linkedin.com/in/timlolkema/"
        target="_blank"
        rel="noopener noreferrer"
        data-i18n-author
        data-author-name="Tim Lolkema"
      >
        By Tim Lolkema
      </a>
    </footer>
    <script src="shop.js"></script>
    <script>
      (function () {
        const btn = document.getElementById("spinAndAdd");
        const display = document.getElementById("slotEmoji");
        const live = document.getElementById("slotStatus");

        // Collect available fruits from global PRODUCTS
        const productEntries = Object.entries(window.PRODUCTS || {});
        const keys = productEntries.map(([k]) => k);
        const emojis = productEntries.map(([, v]) => v.emoji);

        function pickRandom(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }

        let spinning = false;
        let intervalId = null;
        let timeoutId = null;

        function syncButton() {
          btn.textContent = t("slot.addBtn");
        }

        function stopSpin() {
          if (intervalId) clearInterval(intervalId);
          if (timeoutId) clearTimeout(timeoutId);
          intervalId = null;
          timeoutId = null;
          spinning = false;
          btn.disabled = false;
          syncButton();
        }

        btn.addEventListener("click", function () {
          if (spinning) return; // prevent double clicks
          if (!keys.length) {
            // Fallback: nothing configured
            live.textContent = t("slot.none");
            return;
          }

          spinning = true;
          btn.disabled = true;
          btn.textContent = t("slot.spinning");

          // Start cycling through available fruit emojis
          let i = 0;
          display.style.transform = "scale(1)";
          intervalId = setInterval(() => {
            display.textContent = emojis[i % emojis.length];
            // subtle pulse effect
            display.style.transform = i % 2 === 0 ? "scale(1.08)" : "scale(1)";
            i++;
          }, 90);

          // After a short delay, pick a random fruit and add it to basket
          const spinDuration = 1300 + Math.floor(Math.random() * 400); // 1.3-1.7s
          timeoutId = setTimeout(() => {
            const randomKey = pickRandom(keys);
            const emoji = window.PRODUCTS[randomKey].emoji;
            display.textContent = emoji;
            display.style.transform = "scale(1.2)";
            // Slight delay to let the final emoji settle visually
            setTimeout(() => {
              addToBasket(randomKey);
              live.textContent = t("slot.addedLive", { product: productName(randomKey) });
              stopSpin();
            }, 250);
          }, spinDuration);
        });

        // Re-apply translations on load and when language changes externally
        applyTranslations();

        // Cleanup if needed (not strictly necessary on static page)
        window.addEventListener("beforeunload", stopSpin);
      })();
    </script>
    <style>
      /* Screen-reader-only utility */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </body>
</html>
